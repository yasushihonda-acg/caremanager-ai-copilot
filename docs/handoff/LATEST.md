# ãƒãƒ³ãƒ‰ã‚ªãƒ•ãƒ¡ãƒ¢

**æœ€çµ‚æ›´æ–°**: 2026-02-10ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³4ï¼‰

## ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸

**Stage 2: Production Readiness** - ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆæŠ•å…¥ã«å‘ã‘ãŸå“è³ªä¿è¨¼ãƒ»ç²¾åº¦æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º

> é–‹ç™ºãƒ¢ãƒ‡ãƒ«ã‚’Phaseï¼ˆæ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰ã‹ã‚‰Stageï¼ˆé–‹ç™ºã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ï¼‰ã«ç§»è¡Œã€‚è©³ç´°: [ADR 0009](../adr/0009-stage-based-development-model.md)

## ç›´è¿‘ã®å¤‰æ›´

| æ—¥ä»˜ | PR/ã‚³ãƒŸãƒƒãƒˆ | å†…å®¹ |
|------|------------|------|
| 2026-02-10 | PR #9 (40f33bd) | **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç›£æŸ»**ï¼ˆStage 2 P0ï¼‰- 11ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ |
| 2026-02-10 | PR #8 (b0c1d21) | ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—å†æ§‹æˆï¼ˆStage-basedï¼‰ã€ADR 0009 |
| 2026-02-10 | 2a3b463 | ãƒ‡ãƒ¢ç”¨ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼ˆ3ååˆ†ã®åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿ï¼‰ |
| 2026-02-10 | aca5ea9 | clientsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆisActive+kanaï¼‰ |
| 2026-02-10 | #7 | UXæ”¹å–„ãƒãƒƒãƒï¼ˆæ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ»é€²æ—ãƒãƒ¼ãƒ»å®šå‹æ–‡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ |
| 2026-02-10 | #6 | åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆè¤‡æ•°åˆ©ç”¨è€…ç®¡ç†ãƒ»Firestoreãƒã‚¹ãƒˆæ–¹å¼ï¼‰ |
| 2026-02-09 | #5 | ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°å±¥æ­´ä¸€è¦§ãƒ»ç·¨é›†æ©Ÿèƒ½ |

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ï¼ˆé‡è¦ï¼‰

### Firestoreã‚¹ã‚­ãƒ¼ãƒã®ãƒã‚¹ãƒˆåŒ–ï¼ˆPR #6ï¼‰

**æ—§ãƒ‘ã‚¹**: `users/{uid}/assessments/{id}`
**æ–°ãƒ‘ã‚¹**: `users/{uid}/clients/{clientId}/assessments/{id}`

- å…¨ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨è€…ï¼ˆClientï¼‰å˜ä½ã§åˆ†é›¢
- `services/firebase.ts`ã®å…¨é–¢æ•°ã«`clientId`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
- `clientPath()`ãƒ˜ãƒ«ãƒ‘ãƒ¼ã§DRYãªãƒ‘ã‚¹æ§‹ç¯‰
- æ—§ãƒ‘ã‚¹ã¯firestore.rulesã§å¾Œæ–¹äº’æ›ã‚’ç¶­æŒ

### æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `contexts/ClientContext.tsx` | Client CRUD + é¸æŠç®¡ç† |
| `components/clients/ClientListView.tsx` | åˆ©ç”¨è€…ä¸€è¦§ï¼ˆæ¤œç´¢ä»˜ãï¼‰ |
| `components/clients/ClientForm.tsx` | åˆ©ç”¨è€…ç™»éŒ²ãƒ»ç·¨é›† |
| `components/clients/ClientContextBar.tsx` | é¸æŠä¸­åˆ©ç”¨è€…ãƒãƒ¼ |

## MVPå®Ÿè£…çŠ¶æ³ï¼ˆStage 1 å®Œäº†ï¼‰

| æ©Ÿèƒ½ | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| èªè¨¼ï¼ˆGoogleãƒ­ã‚°ã‚¤ãƒ³ï¼‰ | âœ… | Firebase Auth |
| ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆï¼ˆ23é …ç›®ï¼‰ | âœ… | ä¿å­˜ãƒ»èª­è¾¼ãƒ»å±¥æ­´ |
| ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ï¼ˆç¬¬1è¡¨ãƒ»ç¬¬2è¡¨ï¼‰ | âœ… | AIç”Ÿæˆãƒ»å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ² | âœ… | å·®åˆ†å…¥åŠ›ãƒ»å±¥æ­´ä¸€è¦§ |
| æ”¯æ´çµŒéè¨˜éŒ²ï¼ˆç¬¬5è¡¨ï¼‰ | âœ… | éŸ³å£°å…¥åŠ›å¯¾å¿œ |
| ã‚µãƒ¼ãƒ“ã‚¹æ‹…å½“è€…ä¼šè­°ï¼ˆç¬¬4è¡¨ï¼‰ | âœ… | |
| å…¥é™¢æ™‚æƒ…å ±é€£æºã‚·ãƒ¼ãƒˆ | âœ… | è‡ªå‹•ç”Ÿæˆ |
| è¤‡æ•°åˆ©ç”¨è€…ç®¡ç† | âœ… | Firestoreãƒã‚¹ãƒˆæ–¹å¼ |

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç›£æŸ»ï¼ˆPR #9ï¼‰ã®å¤‰æ›´è©³ç´°

### ä¿®æ­£å†…å®¹

| # | ä¿®æ­£ | é‡è¦åº¦ | ãƒ•ã‚¡ã‚¤ãƒ« |
|---|------|--------|---------|
| 2.1 | MonitoringForm clientIdå¼•æ•°æ¬ è½ä¿®æ­£ | Critical | `components/monitoring/MonitoringForm.tsx` |
| 2.2 | ClientForm `undefined`â†’`null`å¤‰æ›ï¼ˆ5ç®‡æ‰€ï¼‰ | Critical | `components/clients/ClientForm.tsx` |
| 2.3 | Cloud Functions transient/permanent ã‚¨ãƒ©ãƒ¼åˆ†é¡ | High | `functions/src/vertexAi.ts` |
| 2.4 | firebase.ts `withFirestoreErrorHandling<T>`ãƒ©ãƒƒãƒ‘ãƒ¼ | High | `services/firebase.ts` |
| 2.5 | ClientContext ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®UIä¼æ’­ | High | `contexts/ClientContext.tsx`, `components/clients/ClientListView.tsx` |
| 2.6 | TouchAssessment AIåˆ†æã‚¨ãƒ©ãƒ¼è¡¨ç¤º | High | `components/assessment/TouchAssessment.tsx` |
| 2.7 | `alert()`â†’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã«çµ±ä¸€ | Medium | `SupportRecordForm.tsx`, `MonitoringForm.tsx` |
| 2.8 | `refineCareGoal`æˆ»ã‚Šå€¤æ‹¡å¼µ | Medium | `services/geminiService.ts`, `App.tsx` |

### æ–°è¦ãƒ‘ã‚¿ãƒ¼ãƒ³

- **`FirestoreError`ã‚¯ãƒ©ã‚¹**: operation/collectionNameä»˜ãã®ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼
- **`classifyVertexError()`**: 429/503/timeoutâ†’`unavailable`ã€ãã®ä»–â†’`internal`
- **`withFirestoreErrorHandling<T>()`**: å…¨Firestoreæ“ä½œã®çµ±ä¸€ãƒ©ãƒƒãƒ‘ãƒ¼
- **ClientDocumentå‹**: `phone?: string` â†’ `phone: string | null`ï¼ˆ5ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆStage 2 P0 - æ®‹ã‚¿ã‚¹ã‚¯ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | ä¾å­˜ |
|---|--------|------|------|
| 1 | ADCå†èªè¨¼ï¼ˆ`gcloud auth application-default login`ï¼‰ | ğŸ”² æ‰‹å‹• | ãªã— |
| 2 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç›£æŸ» | âœ… PR #9 | - |
| 3 | AIç²¾åº¦ã®å®Ÿåœ°ãƒ†ã‚¹ãƒˆï¼ˆCloud Functionsé€£æºãƒ†ã‚¹ãƒˆï¼‰ | ğŸ”² | #1 |
| 4 | æŠ½å‡ºãƒ«ãƒ¼ãƒ«æœ€é©åŒ–ï¼ˆå¼±ç‚¹4é …ç›®ï¼‰ | ğŸ”² | #3 |

### Task 3 å®Ÿè£…æ¦‚è¦ï¼ˆæ¬¡ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

1. `vertexAi.ts`ã®`analyzeAssessment`ã«`textInput?`ãƒ‘ã‚¹ã‚’è¿½åŠ 
2. `tests/assessment/extraction.live.test.ts`ã‚’ä½œæˆï¼ˆ6ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
3. `npm run test:live`ã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç²¾åº¦ã‚’è¨ˆæ¸¬
4. ãƒ–ãƒ©ãƒ³ãƒ: `feature/stage2-ai-accuracy-tests`

### Stage 2 é€€å‡ºåŸºæº–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] P0ã‚¿ã‚¹ã‚¯å…¨å®Œäº†
- [ ] AIæŠ½å‡ºç²¾åº¦85%ä»¥ä¸Šã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¨¼
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç›£æŸ»å®Œäº†ï¼ˆtransient/permanentåˆ†é¡æ¸ˆã¿ï¼‰
- [ ] é‡å¤§ãƒã‚°0ä»¶

## ãƒ‡ãƒ¢ç’°å¢ƒ

- ã‚¢ãƒ—ãƒª: https://caremanager-ai-copilot.web.app
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://yasushihonda-acg.github.io/caremanager-ai-copilot/
- GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: `caremanager-ai-copilot`

## ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å†æŠ•å…¥

```bash
npx tsx scripts/seed.ts bapgVkGOXVep8Tm2vbkxml1vz3D2
```
- gcloud CLIã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`hy.unimail.11@gmail.com`ï¼‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨
- ADCã¯åˆ¥ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`yasushi-honda@tadakayo.jp`ï¼‰ã®ãŸã‚ä½¿ç”¨ä¸å¯

## æ³¨æ„äº‹é …

- `firestore.rules`ã«æ—§ãƒ‘ã‚¹ã®å¾Œæ–¹äº’æ›ãƒ«ãƒ¼ãƒ«ã‚’æ®‹ã—ã¦ã„ã‚‹ï¼ˆå°†æ¥å‰Šé™¤å¯èƒ½ï¼‰
- æ—§ãƒ‘ã‚¹ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•ç§»è¡Œã•ã‚Œãªã„ï¼ˆãƒ‡ãƒ¢æ®µéšã§å°‘é‡ã®ãŸã‚æ‰‹å‹•å¯¾å¿œï¼‰
- ADR 0008ï¼ˆClientãƒã‚¹ãƒˆã‚¹ã‚­ãƒ¼ãƒï¼‰ä½œæˆæ¸ˆã¿
- ADR 0009ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹é–‹ç™ºãƒ¢ãƒ‡ãƒ«ï¼‰ä½œæˆæ¸ˆã¿
