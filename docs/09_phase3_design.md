# 09_phase3_design.md - Phase 3 Design: Logic & Refinement

## 1. 目的
Phase 2レビューで指摘されたUIの課題（一覧性の欠如、入力の硬直性）を解決し、かつ本アプリケーションの核心である「適切なケアマネジメント手法」に基づく支援ロジックを実装する。

## 2. 実装スコープ

### A. アセスメント・サマリービュー (The "Whole Picture")
*   **課題:** タブ切り替え式にしたことで、利用者の全体像（23項目の相関）が直感的に把握しづらくなった。
*   **解決策:** アセスメント画面に「サマリー（全体表示）」タブを追加する。
*   **仕様:**
    *   全23項目の入力内容を、印刷プレビューのように縦スクロールで一覧表示する。
    *   未入力項目は「未確認」としてハイライト表示し、入力漏れを防ぐ（実地指導対策）。

### B. ハイブリッド入力コンポーネント (Hybrid Input)
*   **課題:** 「既往歴」や「服薬」など、ボタン選択（定型文）だけでは表現しきれない項目がある。
*   **解決策:** `QuickOptions` コンポーネントを拡張し、自由記述（詳細テキスト）を併用できるようにする。
*   **仕様:**
    *   各項目の下部に「詳細・特記」テキストエリアを配置（アコーディオン等で開閉、または常時表示）。
    *   ボタンで大枠を選択し、テキストで詳細を補足する "Touch & Type" 形式。

### C. 「適切なケアマネジメント手法」推奨ロジック (Logic Engine)
*   **背景:** 国が示す「適切なケアマネジメント手法」では、基本ケア（疾患や状態に応じた標準的な支援）が定義されている。
*   **機能:** アセスメント結果に基づき、ケアプラン（第2表）の作成を支援するAI/ロジックサジェスト機能。
*   **ロジックルール（例）:**
    *   **Trigger:** 既往歴に「脳血管疾患」が含まれる。
        *   **Action:** 「麻痺の部位・程度の確認」「嚥下機能の評価」「再発予防（血圧管理）」をサジェスト。
    *   **Trigger:** 認知機能が「認知症の疑い」「認知症」である。
        *   **Action:** 「BPSD（徘徊・火の不始末）のリスク評価」「家族の介護負担軽減」をサジェスト。
    *   **Trigger:** 排泄が「オムツ使用」「全介助」である。
        *   **Action:** 「皮膚トラブル（褥瘡）の有無」「排泄ケア用品の適合性」をサジェスト。

## 3. データフローの変更
*   `services/complianceService.ts` に `getCareManagementSuggestions(assessment: AssessmentData): string[]` 関数を追加。
*   UI側でアセスメント入力が完了（または変更）したタイミングで、この関数を呼び出し、画面上部に「推奨される確認事項」としてアラート表示する。

## 4. UI/UXへの反映
*   アセスメント画面の上部に「ケアマネジメント・アシスト」エリアを新設。ロジックに基づく気づきを表示する。
*   「サマリー」タブをアセスメントビューのデフォルト、またはタブの末尾に配置する。