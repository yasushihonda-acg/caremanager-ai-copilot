# PRD: Phase 1 - 認証フローのUI統合

## 概要
Firebase Authenticationを使用したGoogleログインをUIに統合し、認証済みユーザーのみがアプリケーションを使用できるようにする。

## 背景
- `services/firebase.ts`には`signInWithGoogle()`と`signOutUser()`が実装済み
- `App.tsx`はモックデータ（MOCK_USER）を使用しており、認証統合がない
- データ永続化（Phase 2）の前提として、認証によるユーザー識別が必要

## 要件

### 機能要件

#### FR-1: ログイン画面
- 未認証状態でアプリを開くと、ログイン画面を表示する
- 「Googleでログイン」ボタンを配置する
- ボタンクリックでGoogleログインポップアップを表示する
- ログイン成功後、メイン画面に遷移する
- ログイン失敗時、エラーメッセージを表示する

#### FR-2: 認証状態管理
- Firebase AuthのonAuthStateChangedでリアルタイムに認証状態を監視する
- 認証状態をReact Contextで管理する
- ローディング中は適切なインジケーターを表示する

#### FR-3: ログアウト機能
- MenuDrawerにログアウトボタンを追加する
- ログアウト後、ログイン画面に遷移する
- ログアウト時、ローカル状態をリセットする

#### FR-4: ユーザー情報表示
- ヘッダーにログインユーザーの表示名またはメールアドレスを表示する
- MOCK_USERをログインユーザー情報に置き換える（ただしname, birthDate等の利用者情報は別途管理）

### 非機能要件

#### NFR-1: セキュリティ
- 未認証ユーザーはメイン画面にアクセスできない
- Firestoreセキュリティルールは既存のものを使用

#### NFR-2: UX
- 認証状態の読み込み中はスピナーを表示する
- ログイン処理中はボタンを無効化する

## 画面設計

### ログイン画面
```
+----------------------------------+
|                                  |
|       🏠 ケアマネのミカタ         |
|                                  |
|     ケアマネージャー向け          |
|     AI支援アプリケーション        |
|                                  |
|   +------------------------+     |
|   | G  Googleでログイン    |     |
|   +------------------------+     |
|                                  |
|   [エラーメッセージ表示エリア]    |
|                                  |
+----------------------------------+
```

### メイン画面（変更点）
- ヘッダー右上: ユーザー名 + ログアウトボタン

## 技術設計

### 新規ファイル
- `components/LoginScreen.tsx` - ログイン画面コンポーネント
- `contexts/AuthContext.tsx` - 認証状態コンテキスト

### 変更ファイル
- `App.tsx` - AuthProviderでラップ、認証状態に応じた画面切り替え
- `components/MenuDrawer.tsx` - ログアウトボタン追加

### 依存関係
- `services/firebase.ts`（既存）- auth, signInWithGoogle, signOutUser

## テストケース

### TC-1: ログイン成功
1. ログイン画面を表示
2. 「Googleでログイン」をクリック
3. Googleアカウントを選択
4. メイン画面に遷移することを確認

### TC-2: ログアウト成功
1. メイン画面を表示（ログイン済み）
2. メニューを開く
3. 「ログアウト」をクリック
4. ログイン画面に遷移することを確認

### TC-3: 認証状態の永続性
1. ログイン済みの状態でページをリロード
2. 再度メイン画面が表示されることを確認（再ログイン不要）

### TC-4: ログイン失敗時のエラー表示
1. ログインポップアップをキャンセル
2. エラーメッセージが表示されることを確認

## 実装順序
1. AuthContext作成
2. LoginScreen作成
3. App.tsx修正（AuthProviderでラップ、画面切り替え）
4. MenuDrawer修正（ログアウト追加）
5. 手動テスト
6. コミット

## 完了条件
- [ ] Googleログインができる
- [ ] ログアウトができる
- [ ] 認証状態に応じた画面切り替え
- [ ] ページリロード後も認証状態が維持される
- [ ] エラー時に適切なメッセージが表示される
